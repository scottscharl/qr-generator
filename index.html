<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Code Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body class="bg-gray-900 min-h-screen p-4 sm:p-6 lg:p-8">
    <main class="max-w-4xl mx-auto">
      <div class="flex items-center justify-between mb-6 sm:mb-8">
        <div class="flex items-center gap-3">
          <img
            src="data:image/webp;base64,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"
            alt="QR Avatar"
            class="w-12 h-12 rounded-lg border-2 border-gray-700 shadow-lg"
          />
          <h1 class="text-3xl sm:text-4xl font-bold text-white">
            QR Code Generator
          </h1>
        </div>
        <a
          href="https://github.com/scottscharl/qr-generator"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-1.5 text-gray-400 hover:text-white transition-colors text-sm"
          title="View on GitHub"
        >
          <i data-lucide="github" class="w-4 h-4"></i>
          <span class="hidden sm:inline">View on GitHub</span>
        </a>
      </div>

      <!-- Form Card -->
      <div class="bg-gray-800 rounded-lg shadow-xl p-4 sm:p-6 mb-6 sm:mb-8">
        <form id="generatorForm">
          <div class="flex justify-between items-center mb-2">
            <label class="block text-sm font-medium text-gray-300">
              Enter some text:
            </label>
            <span id="charCounter" class="text-xs text-gray-400"
              >0 / 2,950</span
            >
          </div>
          <input
            type="text"
            id="textInput"
            placeholder="https://example.com"
            required
            autofocus
            maxlength="2950"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-white placeholder-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"
          />
          <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
            <button
              type="submit"
              id="submitBtn"
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed"
            >
              Generate
              <span
                class="text-xs ml-1 px-1.5 py-0.5 border border-white/30 rounded"
                >ENTER</span
              >
            </button>
            <button
              type="button"
              id="clearButton"
              class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-medium py-2 px-4 rounded-md transition-colors"
            >
              Clear
            </button>
          </div>
        </form>
      </div>

      <!-- QR Code Container -->
      <div id="qrContainer" class="space-y-4"></div>

      <!-- Modal -->
      <dialog
        id="qrModal"
        class="backdrop:bg-black backdrop:bg-opacity-75 rounded-lg shadow-xl p-0 max-w-md w-full bg-transparent"
      >
        <div class="bg-gray-800 rounded-lg">
          <div
            class="flex items-center justify-between p-4 border-b border-gray-700"
          >
            <h3 class="text-xl font-semibold text-white">QR Code</h3>
            <button
              id="closeModal"
              class="text-gray-400 hover:text-gray-200 text-2xl leading-none"
            >
              Ã—
            </button>
          </div>
          <div id="modalContent" class="p-6 bg-white flex justify-center"></div>
          <div class="p-4 border-t border-gray-700 space-y-2">
            <button
              id="downloadBtn"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors"
            >
              Download
            </button>
            <button
              id="shareBtn"
              class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors hidden"
            >
              Share
            </button>
          </div>
        </div>
      </dialog>
    </main>

    <script>
      const form = document.getElementById("generatorForm");
      const input = document.getElementById("textInput");
      const qrContainer = document.getElementById("qrContainer");
      const clearButton = document.getElementById("clearButton");
      const submitBtn = document.getElementById("submitBtn");
      const qrModal = document.getElementById("qrModal");
      const closeModal = document.getElementById("closeModal");
      const modalContent = document.getElementById("modalContent");
      const downloadBtn = document.getElementById("downloadBtn");
      const shareBtn = document.getElementById("shareBtn");
      const charCounter = document.getElementById("charCounter");

      let currentQRData = null;
      let lastSubmitTime = 0;
      const minDelay = 1000;
      const maxLength = 2950;

      // Update character counter
      function updateCharCounter() {
        const length = input.value.length;
        charCounter.textContent = `${length.toLocaleString()} / ${maxLength.toLocaleString()}`;

        // Change color as approaching limit
        if (length > maxLength * 0.9) {
          charCounter.classList.remove("text-gray-400", "text-yellow-400");
          charCounter.classList.add("text-red-400");
        } else if (length > maxLength * 0.75) {
          charCounter.classList.remove("text-gray-400", "text-red-400");
          charCounter.classList.add("text-yellow-400");
        } else {
          charCounter.classList.remove("text-yellow-400", "text-red-400");
          charCounter.classList.add("text-gray-400");
        }
      }

      input.addEventListener("input", updateCharCounter);

      // Initialize Lucide icons
      lucide.createIcons();

      // Check if Web Share API is supported
      if (navigator.share) {
        shareBtn.classList.remove("hidden");
      }

      form.addEventListener("submit", (event) => {
        event.preventDefault();

        const now = Date.now();
        if (now - lastSubmitTime < minDelay) {
          alert("Please wait before generating another QR code");
          return;
        }
        lastSubmitTime = now;

        submitBtn.disabled = true;
        submitBtn.innerHTML =
          'Generating... <span class="text-xs ml-1 px-1.5 py-0.5 border border-white/30 rounded">ENTER</span>';

        const itemText = input.value;

        var typeNumber = 0; // Auto-fit to determine appropriate size
        var errorCorrectionLevel = "L";
        var qr = qrcode(typeNumber, errorCorrectionLevel);
        qr.addData(itemText);
        qr.make();

        // Create QR item card
        const qrItem = document.createElement("div");
        qrItem.className =
          "bg-gray-800 rounded-lg shadow-xl p-4 flex flex-col sm:flex-row sm:items-center gap-4 min-h-[120px]";

        // QR Image - Make it clickable
        const qrImg = document.createElement("div");
        qrImg.innerHTML = qr.createImgTag(3, 5);
        qrImg.className =
          "flex-shrink-0 mx-auto sm:mx-0 cursor-pointer hover:opacity-80 transition-opacity self-center";
        qrImg.onclick = () => showModal(itemText, qr);

        // Content
        const qrContent = document.createElement("div");
        qrContent.className =
          "flex-1 text-center sm:text-left text-gray-300 overflow-hidden";
        qrContent.textContent = itemText;
        qrContent.style.display = "-webkit-box";
        qrContent.style.webkitLineClamp = "2";
        qrContent.style.webkitBoxOrient = "vertical";
        qrContent.style.overflow = "hidden";
        qrContent.style.textOverflow = "ellipsis";

        // Actions
        const qrActions = document.createElement("div");
        qrActions.className =
          "flex flex-row gap-2 sm:flex-shrink-0 justify-center sm:justify-start flex-wrap";

        const viewBtn = document.createElement("button");
        viewBtn.innerHTML =
          '<i data-lucide="eye" class="w-4 h-4 inline mr-1.5"></i>View';
        viewBtn.className =
          "px-3 py-1.5 text-sm bg-blue-600 text-white hover:bg-blue-700 rounded-md transition-colors inline-flex items-center";
        viewBtn.onclick = () => showModal(itemText, qr);

        const downloadItemBtn = document.createElement("button");
        downloadItemBtn.innerHTML =
          '<i data-lucide="download" class="w-4 h-4 inline mr-1.5"></i>Download';
        downloadItemBtn.className =
          "px-3 py-1.5 text-sm bg-gray-700 text-gray-300 hover:bg-gray-600 rounded-md transition-colors inline-flex items-center";
        downloadItemBtn.onclick = () => downloadQR(qr, itemText);

        const shareItemBtn = document.createElement("button");
        shareItemBtn.innerHTML =
          '<i data-lucide="share-2" class="w-4 h-4 inline mr-1.5"></i>Share';
        shareItemBtn.className =
          "px-3 py-1.5 text-sm bg-gray-700 text-gray-300 hover:bg-gray-600 rounded-md transition-colors inline-flex items-center";
        shareItemBtn.onclick = async () => {
          try {
            const dataUrl = qr.createDataURL(8, 20);
            const response = await fetch(dataUrl);
            const blob = await response.blob();
            const file = new File([blob], `qrcode-${Date.now()}.png`, {
              type: "image/png",
            });
            await navigator.share({
              files: [file],
              title: "QR Code",
              text: itemText,
            });
          } catch (error) {
            console.log("Share failed:", error);
          }
        };

        // Only show share button if Web Share API is supported
        if (!navigator.share) {
          shareItemBtn.style.display = "none";
        }

        const deleteBtn = document.createElement("button");
        deleteBtn.innerHTML =
          '<i data-lucide="trash-2" class="w-4 h-4 inline mr-1.5"></i>Delete';
        deleteBtn.className =
          "px-3 py-1.5 text-sm bg-gray-700 text-gray-300 hover:bg-red-600 hover:text-white rounded-md transition-colors inline-flex items-center";
        deleteBtn.onclick = () => qrItem.remove();

        qrActions.appendChild(viewBtn);
        qrActions.appendChild(downloadItemBtn);
        qrActions.appendChild(shareItemBtn);
        qrActions.appendChild(deleteBtn);

        qrItem.appendChild(qrImg);
        qrItem.appendChild(qrContent);
        qrItem.appendChild(qrActions);

        qrContainer.insertBefore(qrItem, qrContainer.firstChild);

        // Initialize Lucide icons for the new buttons
        lucide.createIcons();

        // Select the text instead of clearing it
        input.select();

        // Auto-open modal after generation
        showModal(itemText, qr);

        setTimeout(() => {
          submitBtn.disabled = false;
          submitBtn.innerHTML =
            'Generate <span class="text-xs ml-1 px-1.5 py-0.5 border border-white/30 rounded">ENTER</span>';
        }, 1000);
      });

      function showModal(text, qr) {
        modalContent.innerHTML = `
          <div class="flex flex-col items-center w-full">
            ${qr.createImgTag(8, 20)}
            <p class="mt-4 text-gray-700 font-medium text-center whitespace-nowrap overflow-hidden text-ellipsis max-w-full px-4">${text}</p>
          </div>
        `;
        currentQRData = { text, qr };
        qrModal.showModal();
      }

      function downloadQR(qr, text) {
        const dataUrl = qr.createDataURL(8, 20);
        const link = document.createElement("a");
        link.download = `qrcode-${Date.now()}.png`;
        link.href = dataUrl;
        link.click();
      }

      closeModal.addEventListener("click", () => {
        qrModal.close();
      });

      // Close modal when clicking outside of it (on backdrop)
      qrModal.addEventListener("click", (e) => {
        const dialogDimensions = qrModal.getBoundingClientRect();
        if (
          e.clientX < dialogDimensions.left ||
          e.clientX > dialogDimensions.right ||
          e.clientY < dialogDimensions.top ||
          e.clientY > dialogDimensions.bottom
        ) {
          qrModal.close();
        }
      });

      downloadBtn.addEventListener("click", () => {
        if (!currentQRData) return;
        downloadQR(currentQRData.qr, currentQRData.text);
      });

      shareBtn.addEventListener("click", async () => {
        if (!currentQRData) return;

        try {
          // Convert QR code to blob
          const dataUrl = currentQRData.qr.createDataURL(8, 20);
          const response = await fetch(dataUrl);
          const blob = await response.blob();
          const file = new File([blob], `qrcode-${Date.now()}.png`, {
            type: "image/png",
          });

          await navigator.share({
            files: [file],
            title: "QR Code",
            text: currentQRData.text,
          });
        } catch (error) {
          // User cancelled or error occurred
          console.log("Share failed:", error);
        }
      });

      clearButton.addEventListener("click", () => {
        input.value = "";
      });
    </script>
  </body>
</html>
